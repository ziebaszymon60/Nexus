<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - Nexus</title>
    <meta name="description" content="Reset your Nexus account password.">
    <link rel="stylesheet" href="style.css?v=2.0">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">
</head>

<body>
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-logo">üîê</div>
            <h1>Recovery</h1>
            <p>Don't worry, it happens to the best of us!</p>

            <div id="message" class="message"></div>

            <!-- Step 1: Email -->
            <form id="requestForm">
                <div class="form-group">
                    <label for="email">Enter your Email</label>
                    <input type="email" id="email" required placeholder="your@email.com">
                </div>
                <button type="submit" class="btn btn-primary">
                    Send Recovery Code üìß
                </button>
            </form>

            <!-- Step 2: Code & New Password (Hidden) -->
            <form id="resetForm" style="display: none;">
                <div class="form-group">
                    <label for="code">Recovery Code</label>
                    <input type="text" id="code" required placeholder="123456" maxlength="6"
                        style="letter-spacing: 4px; text-align: center;">
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <div class="password-input-group">
                        <input type="password" id="newPassword" required placeholder="New strong password"
                            minlength="6">
                        <button type="button" id="togglePassword" class="toggle-password"
                            title="Show/Hide Password">üëÅÔ∏è</button>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">
                    Reset Password ‚ö°
                </button>
            </form>

            <div class="auth-footer">
                <p><a href="login.html">‚Üê Back to Login</a></p>
            </div>
        </div>
    </div>

    <script src="app.js?v=2.0"></script>
    <script>
        const requestForm = document.getElementById('requestForm');
        const resetForm = document.getElementById('resetForm');
        let currentEmail = '';

        // Step 1: Request Code
        requestForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const email = document.getElementById('email').value;

            const result = Nexus.requestPasswordReset(email);

            if (result.success) {
                showMessage(result.message, 'success');
                currentEmail = email;

                // Show "Code sent" behavior
                // SIMULATION: Show code directly on screen so user doesn't wait for real email
                const codeDisplay = document.createElement('div');
                codeDisplay.style.background = '#eff6ff'; // Light blue
                codeDisplay.style.border = '2px dashed #3b82f6';
                codeDisplay.style.padding = '16px';
                codeDisplay.style.borderRadius = '12px';
                codeDisplay.style.margin = '20px 0';
                codeDisplay.style.textAlign = 'center';

                codeDisplay.innerHTML = `
                    <p style="font-weight: bold; color: #1e40af; margin-bottom: 8px;">üìß SIMULATED INBOX</p>
                    <p>To: ${email}</p>
                    <p>Subject: Password Reset</p>
                    <hr style="margin: 8px 0; border: 0; border-top: 1px solid #bfdbfe;">
                    <p style="font-size: 1.4rem; font-weight: bold; letter-spacing: 2px;">${result.code}</p>
                `;

                // Insert after message
                document.getElementById('message').after(codeDisplay);

                setTimeout(() => {
                    requestForm.style.display = 'none';
                    resetForm.style.display = 'block';
                    window.scrollTo(0, 0); // Scroll to top
                }, 4000);
            } else {
                showMessage(result.message, 'error');
            }
        });

        // Step 2: Confirm Reset
        resetForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const code = document.getElementById('code').value;
            const newPass = document.getElementById('newPassword').value;

            const result = Nexus.confirmPasswordReset(currentEmail, code, newPass);

            if (result.success) {
                showMessage(result.message, 'success');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
            } else {
                showMessage(result.message, 'error');
            }
        });

        // Init Password Toggle
        Nexus.initPasswordToggle('newPassword', 'togglePassword');
    </script>
</body>

</html>